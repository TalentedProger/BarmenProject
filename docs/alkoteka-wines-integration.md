# Интеграция вин из Alkoteka

## Описание

Добавлены **20 реальных позиций вин** из магазина Alkoteka с полными характеристиками:
- Название
- Крепость (ABV)
- Цена за литр
- Объем упаковки
- Вкусовой профиль
- Ссылка на товар в магазине
- Иконка источника

## Структура данных

### Новые поля в таблице `ingredients`

```sql
source_url VARCHAR(500)     -- URL товара на сайте источника
source_name VARCHAR(100)    -- Название магазина/источника (например, "Alkoteka")
source_icon VARCHAR(500)    -- URL иконки магазина
volume INTEGER              -- Объем упаковки в мл (например, 750)
```

## Категории вин

### Красные вина (5 позиций)
- Chateau Tamagne Reserve Каберне
- Киндзмараули красное полусладкое
- Кубань-Вино Мерло
- Fanagoria Пино Нуар
- Масандра Каберне Качинское

### Белые вина (5 позиций)
- Шардоне Fanagoria
- Chateau Tamagne Совиньон Блан
- Кубань-Вино Рислинг
- Инкерман Мускат белый
- Абрау-Дюрсо Пино Блан

### Розовые вина (2 позиции)
- Fanagoria Розе
- Chateau Tamagne Розе

### Игристые вина (3 позиции)
- Абрау-Дюрсо Брют
- Российское Шампанское полусладкое
- Cricova Sparkling Brut

### Десертные вина (3 позиции)
- Масандра Портвейн Крымский
- Кагор Южнобережный
- Мускат Розовый Крымский

### Крепленые вина (2 позиции)
- Массандра Мадера Крымская
- Инкерман Херес

## Использование

### 1. Применить миграцию БД

```bash
npm run db:push
```

Или выполнить SQL-миграцию вручную:
```bash
psql -d your_database -f migrations/0005_add_ingredient_source_fields.sql
```

### 2. Инициализировать вина из Alkoteka

```bash
npm run init:alkoteka
```

Скрипт автоматически:
- Проверит существующие вина (не добавит дубликаты)
- Добавит 20 новых позиций с полными характеристиками
- Покажет подробную статистику

### 3. Проверка в интерфейсе

Откройте страницу конструктора: `http://localhost:3000/constructor`

В контейнере **"Ингредиенты"**:
1. Выберите категорию **"Алкоголь"**
2. В выпадающем списке выберите тип **"Вино красное"**, **"Вино белое"** или другие типы вин
3. У каждого вина будет:
   - Маленькая иконка Alkoteka справа от названия
   - При клике на иконку откроется страница товара на сайте Alkoteka
   - Указан объем упаковки (например, 750мл)

## UI изменения

### IngredientCard компонент

Обновлен для отображения:
- **Иконка источника**: Кликабельная иконка магазина справа от названия
- **Объем упаковки**: Отображается в подзаголовке (например, "Алкоголь • 750мл")
- **Ссылка на товар**: При клике открывается в новой вкладке
- **Плавная анимация**: Иконка меняет прозрачность при наведении

```tsx
{ingredient.sourceUrl && ingredient.sourceName && (
  <a href={ingredient.sourceUrl} target="_blank" rel="noopener noreferrer">
    <img src={ingredient.sourceIcon} alt={ingredient.sourceName} />
  </a>
)}
```

## Расширение на другие источники

Для добавления ингредиентов из других магазинов:

1. Создайте файл данных (например, `client/src/lib/metro-wines-data.ts`)
2. Следуйте структуре `alkoteka-wines-data.ts`
3. Укажите:
   - `sourceName`: название магазина
   - `sourceUrl`: ссылка на товар
   - `sourceIcon`: URL иконки (favicon магазина)
4. Создайте скрипт инициализации
5. Добавьте в `ingredients-data.ts`

## Примеры использования

### Добавить вино вручную через API

```typescript
await db.insert(ingredients).values({
  name: "Новое вино",
  category: "alcohol",
  color: "#722F37",
  abv: "13",
  pricePerLiter: "800",
  volume: 750,
  tasteProfile: { sweet: 1, sour: 3, bitter: 6, alcohol: 3 },
  unit: "ml",
  sourceUrl: "https://alkoteka.com/product/example",
  sourceName: "Alkoteka",
  sourceIcon: "https://alkoteka.com/app/images/common/favicon.ico"
});
```

### Фильтрация по источнику

```typescript
const alkotekaWines = await db.query.ingredients.findMany({
  where: eq(ingredients.sourceName, "Alkoteka")
});
```

## Статистика

После инициализации:
- ✅ 20 новых реальных позиций вин
- ✅ Все с ссылками на Alkoteka
- ✅ Полные характеристики (ABV, цена, объем)
- ✅ Вкусовые профили
- ✅ Кликабельные иконки источника

## Будущие улучшения

- [ ] Автоматический парсинг цен с сайта
- [ ] Обновление наличия товара
- [ ] Интеграция с API Alkoteka
- [ ] Добавление большего количества позиций
- [ ] Поддержка других магазинов (Metro, Красное & Белое, WineStyle)
- [ ] Система сравнения цен из разных источников
