/**
 * –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–º–æ—â–∏ –≤ —Ä—É—á–Ω–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å–æ–∫–æ–≤
 * 
 * –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
 * 1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ç–∞–ª–æ–≥ https://krasnoeibeloe.ru/catalog/soki-i-nektary/
 * 2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã (—Å–æ–∫–∏, –Ω–µ–∫—Ç–∞—Ä—ã, –Ω–∞–ø–∏—Ç–∫–∏, –æ–±—ä–µ–º 0.2-2–ª)
 * 3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞:
 *    - –ù–∞–π–¥–∏—Ç–µ —Ç–æ–≤–∞—Ä –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
 *    - –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
 *    - –í—Å—Ç–∞–≤—å—Ç–µ URL –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –º–µ—Å—Ç–æ –Ω–∏–∂–µ
 * 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç: npx tsx scripts/add-juice-images-manually.ts
 */

import * as fs from 'fs';
import * as path from 'path';

// –ó–ê–ü–û–õ–ù–ò–¢–ï –≠–¢–û–¢ –û–ë–™–ï–ö–¢ URL-–º–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
// –§–æ—Ä–º–∞—Ç: "–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞": "URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
const JUICE_IMAGES: Record<string, string> = {
  // –ü—Ä–∏–º–µ—Ä:
  "–ù–∞–ø–∏—Ç–æ–∫ –î–æ–±—Ä—ã–π –ê–ø–µ–ª—å—Å–∏–Ω 2–ª": "https://krasnoeibeloe.servicecdn.ru/upload/resize_cache/iblock/f5f/een22d3en21bxrii0xefa5vfv2dm2los/200_356_1/mandarin_040624_t.jpg",
  
  // === –§–∞–π–ª krasnoeibeloe-juices-part1.ts ===
  "–ù–µ–∫—Ç–∞—Ä –º—É–ª—å—Ç–∏—Ñ—Ä—É–∫—Ç 1.93–ª": "",
  "–°–æ–∫ –ö—Ä–∞–ª –ì—Ä–∞–Ω–∞—Ç–æ–≤—ã–π 1–ª": "",
  "–ù–µ–∫—Ç–∞—Ä –î–æ–±—Ä—ã–π –ú—É–ª—å—Ç–∏—Ñ—Ä—É–∫—Ç 2–ª": "",
  "–°–æ–∫ –†–∏—á –ì—Ä–µ–π–ø—Ñ—Ä—É—Ç 1–ª": "",
  "–ù–µ–∫—Ç–∞—Ä –†–∏—á –í–∏—à–Ω—è 1–ª": "",
  "–ù–∞–ø–∏—Ç–æ–∫ –î–æ–±—Ä—ã–π –ü–∞–ª–ø–∏ –ê–ø–µ–ª—å—Å–∏–Ω": "",
  "–°–æ–∫ –†–∏—á –Ø–±–ª–æ–∫–æ 1–ª": "",
  "–°–æ–∫ –†–∏—á –¢–æ–º–∞—Ç —Å —Å–æ–ª—å—é 1–ª": "",
  "–°–æ–∫ –†–∏—á –ê–Ω–∞–Ω–∞—Å —Å –º—è–∫–æ—Ç—å—é 1–ª": "",
  "–ù–µ–∫—Ç–∞—Ä –ö—Ä–∞–ª –º–∞–Ω–≥–æ 1–ª": "",
  "–°–æ–∫ –ö—Ä–∞–ª –ì—Ä–∞–Ω–∞—Ç–æ–≤—ã–π 0.25–ª": "",
  "–ù–∞–ø–∏—Ç–æ–∫ –ú–æ—Ä—Å—ç–ª—å –∫–ª—é–∫–≤–∞ 1–ª": "",
  "–°–æ–∫ –§—Ä—É—Ç–æ–ù—è–Ω—è –Ø–±–ª–æ–∫–æ 0.2–ª": "",
  "–°–æ–∫ –°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è —è–±–ª–æ—á–Ω—ã–π 1–ª": "",
  "–ù–µ–∫—Ç–∞—Ä —è–±–ª–æ—á–Ω—ã–π 1.93–ª": "",
  "–ù–µ–∫—Ç–∞—Ä –°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è —Ç–æ–º–∞—Ç": "",
  "–°–æ–∫ –°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è —Ç–æ–º–∞—Ç 1–ª": "",
  "–ú–æ—Ä—Å DeVita –∫–ª—é–∫–≤–µ–Ω–Ω—ã–π 1–ª": "",
  "–ù–µ–∫—Ç–∞—Ä –ú–æ–π –º—É–ª—å—Ç–∏—Ñ—Ä—É–∫—Ç 0.2–ª": "",
  "–ù–µ–∫—Ç–∞—Ä –°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è 0.95–ª": "",
  "–ù–µ–∫—Ç–∞—Ä –°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è —è–±–ª–æ–∫–æ": "",
  "–°–æ–∫ –°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è —è–±–ª–æ–∫–æ-—Å–º–æ—Ä": "",
  "–ù–µ–∫—Ç–∞—Ä –ö—Ä–∞–ª –≤–∏—à–Ω—è 1–ª": "",
  
  // === –§–∞–π–ª krasnoeibeloe-juices-part2.ts ===
  "–°–æ–∫ –ú–æ–π –∑–µ–ª–µ–Ω–æ–µ —è–±–ª–æ–∫–æ 0.2–ª": "",
  "–ù–µ–∫—Ç–∞—Ä –°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è —á–µ—Ä–µ—à–Ω—è": "",
  "–ù–µ–∫—Ç–∞—Ä –î–æ–±—Ä—ã–π –Ø–±–ª–æ–∫–æ 2–ª": "",
  "–ù–µ–∫—Ç–∞—Ä –î–æ–±—Ä—ã–π –¢–æ–º–∞—Ç 2–ª": "",
  "–ù–∞–ø–∏—Ç–æ–∫ –ê–ª–æ—ç –í–µ—Ä–∞ 0.525–ª": "",
  "–°–æ–∫ –§—Ä—É—Ç–æ–ù—è–Ω—è —è–±–ª–æ–∫–æ-–≤–∏—à–Ω—è": "",
  "–ù–µ–∫—Ç–∞—Ä DeVita —è–±–ª–æ–∫–æ-–≤–∏—à–Ω—è 1–ª": "",
  "–ù–µ–∫—Ç–∞—Ä –°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è 1.93–ª": "",
  "–ù–µ–∫—Ç–∞—Ä DeVita —è–±–ª–æ—á–Ω—ã–π 1–ª": "",
  "–°–æ–∫ –ú–∏ –º–∏ –º–∏—à–∫–∏ –º—É–ª—å—Ç–∏—Ñ—Ä—É–∫—Ç": "",
  "–ù–∞–ø–∏—Ç–æ–∫ Organic –∞—Ä–±—É–∑-–∞–ª–æ—ç": "",
  "–ù–µ–∫—Ç–∞—Ä –ú–∏ –º–∏ –º–∏—à–∫–∏ –±–∞–Ω–∞–Ω 0.2–ª": "",
  "–ù–µ–∫—Ç–∞—Ä –†–∏—á –ê–ø–µ–ª—å—Å–∏–Ω 1–ª": "",
  "–ù–µ–∫—Ç–∞—Ä –°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è —è–±–ª–æ—á–Ω—ã–π": "",
  "–°–æ–∫ –ê–≥—É—à–∞ —è–±–ª–æ–∫–æ 0.2–ª": "",
  "–°–æ–∫ –ê–≥—É—à–∞ —è–±–ª–æ–∫–æ-–ø–µ—Ä—Å–∏–∫": "",
  "–°–æ–∫ –ú–∏ –º–∏ –º–∏—à–∫–∏ —è–±–ª–æ–∫–æ-–≤–∏—à–Ω—è": "",
  "–°–æ–∫ –°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è –∑–µ–ª–µ–Ω–æ–µ —è–±": "",
  "–°–æ–∫ –°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è —è–±–ª–æ–∫–æ-–≤–∏—à–Ω—è": "",
  "–°–æ–∫ –°–∞–¥—ã –ü—Ä–∏–¥–æ–Ω—å—è —è–±–ª–æ–∫–æ-–≥—Ä—É—à–∞": "",
};

function updateJuiceFiles() {
  const part1Path = path.join(__dirname, '../client/src/lib/krasnoeibeloe-juices-part1.ts');
  const part2Path = path.join(__dirname, '../client/src/lib/krasnoeibeloe-juices-part2.ts');
  
  // –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö URL
  const filled = Object.values(JUICE_IMAGES).filter(url => url && url.length > 10).length;
  const total = Object.keys(JUICE_IMAGES).length;
  
  console.log(`\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: ${filled}/${total} URL –∑–∞–ø–æ–ª–Ω–µ–Ω–æ`);
  
  if (filled === 0) {
    console.log('\n‚ö†Ô∏è  –ù–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö URL!');
    console.log('–û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—ä–µ–∫—Ç JUICE_IMAGES');
    console.log('–ü—Ä–∏–º–µ—Ä: "–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞": "https://krasnoeibeloe.servicecdn.ru/..."');
    return;
  }
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
  for (const [name, imageUrl] of Object.entries(JUICE_IMAGES)) {
    if (!imageUrl || imageUrl.length < 10) continue;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±–∞ —Ñ–∞–π–ª–∞
    updateFileWithImage(part1Path, name, imageUrl);
    updateFileWithImage(part2Path, name, imageUrl);
  }
  
  console.log('\n‚úÖ –§–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã!');
  console.log('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã:');
  console.log('- client/src/lib/krasnoeibeloe-juices-part1.ts');
  console.log('- client/src/lib/krasnoeibeloe-juices-part2.ts');
}

function updateFileWithImage(filePath: string, name: string, imageUrl: string) {
  if (!fs.existsSync(filePath)) return;
  
  let content = fs.readFileSync(filePath, 'utf-8');
  
  // –ò—â–µ–º –∑–∞–ø–∏—Å—å —Å —ç—Ç–∏–º name –∏ –¥–æ–±–∞–≤–ª—è–µ–º imageUrl
  const namePattern = `name: "${name}"`;
  if (content.includes(namePattern)) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ imageUrl
    const lines = content.split('\n');
    const nameIndex = lines.findIndex(line => line.includes(namePattern));
    
    if (nameIndex !== -1) {
      // –ò—â–µ–º –∫–æ–Ω–µ—Ü –æ–±—ä–µ–∫—Ç–∞ (—Å–ª–µ–¥—É—é—â—É—é –∑–∞–ø—è—Ç—É—é –ø–æ—Å–ª–µ })
      let endIndex = nameIndex;
      let braceCount = 0;
      for (let i = nameIndex; i < lines.length; i++) {
        if (lines[i].includes('{')) braceCount++;
        if (lines[i].includes('}')) {
          braceCount--;
          if (braceCount === 0 && lines[i].includes(',')) {
            endIndex = i;
            break;
          }
        }
      }
      
      // –í—Å—Ç–∞–≤–ª—è–µ–º imageUrl –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–µ–π —Å–∫–æ–±–∫–æ–π
      if (endIndex > nameIndex) {
        const insertLine = lines[endIndex].replace(' },', `, imageUrl: "${imageUrl}" },`);
        lines[endIndex] = insertLine;
        content = lines.join('\n');
        fs.writeFileSync(filePath, content, 'utf-8');
        console.log(`‚úì –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${name}`);
      }
    }
  }
}

// –ó–∞–ø—É—Å–∫
updateJuiceFiles();
