<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü–∞—Ä—Å–µ—Ä –≥–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞–ø–∏—Ç–∫–æ–≤</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 32px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    .step {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      border-left: 4px solid #667eea;
    }
    .step h2 {
      color: #333;
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .step-number {
      background: #667eea;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 16px;
    }
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }
    button:active {
      transform: translateY(0);
    }
    textarea {
      width: 100%;
      min-height: 300px;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      resize: vertical;
      margin-top: 10px;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
    }
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }
    .success {
      background: #10b981;
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      display: none;
    }
    .code-block {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      margin-top: 10px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }
    .warning {
      background: #fff3cd;
      border: 1px solid #ffc107;
      color: #856404;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ü•§ –ü–∞—Ä—Å–µ—Ä –≥–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞–ø–∏—Ç–∫–æ–≤</h1>
    <p class="subtitle">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å krasnoeibeloe.ru</p>

    <div class="warning">
      <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ!</strong> –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ —Ç–æ–π –∂–µ –≤–∫–ª–∞–¥–∫–µ, –≥–¥–µ –æ—Ç–∫—Ä—ã—Ç –∫–∞—Ç–∞–ª–æ–≥ krasnoeibeloe.ru, 
      –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ bookmarklet –Ω–∏–∂–µ.
    </div>

    <!-- –®–∞–≥ 1: Bookmarklet -->
    <div class="step">
      <h2>
        <span class="step-number">1</span>
        –°–æ–∑–¥–∞–π—Ç–µ –∑–∞–∫–ª–∞–¥–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
      </h2>
      <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –≤ –ø–∞–Ω–µ–ª—å –∑–∞–∫–ª–∞–¥–æ–∫:</p>
      <p style="margin: 15px 0;">
        <a href="javascript:(function(){const products=[];const links=document.querySelectorAll('a[href*=%22/gazirovannaya-voda/%22]');links.forEach(link=>{const href=link.href;if(products.some(p=>p.url===href))return;const name=link.textContent.trim();const parent=link.closest('[class*=%22item%22]');if(!parent)return;const text=parent.textContent;let country='–†–æ—Å—Å–∏—è';if(text.includes('–ö–æ—Ä–µ—è'))country='–ö–æ—Ä–µ—è';const volumeMatch=text.match(/(\d+(?:\.\d+)?)\s*(–ª|–º–ª)/);let volume='';if(volumeMatch)volume=volumeMatch[0];products.push({name,country,volume,url:href,price:0});});const json=JSON.stringify(products,null,2);const blob=new Blob([json],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='sodas-links.json';a.click();alert('–ù–∞–π–¥–µ–Ω–æ '+products.length+' —Ç–æ–≤–∞—Ä–æ–≤. –§–∞–π–ª sodas-links.json —Å–∫–∞—á–∞–Ω!')})();" 
          style="background: #667eea; color: white; padding: 10px 20px; border-radius: 6px; text-decoration: none; display: inline-block; font-weight: 600;">
          üì• –°–æ–±—Ä–∞—Ç—å —Å—Å—ã–ª–∫–∏
        </a>
      </p>
      <p style="color: #666; font-size: 14px; margin-top: 10px;">
        –ó–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ç–∞–ª–æ–≥ –≥–∞–∑–∏—Ä–æ–≤–æ–∫ –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ —ç—Ç—É –∑–∞–∫–ª–∞–¥–∫—É. –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∞—é—Ç—Å—è.
      </p>
    </div>

    <!-- –®–∞–≥ 2: –°–∫—Ä–∏–ø—Ç –¥–ª—è Console -->
    <div class="step">
      <h2>
        <span class="step-number">2</span>
        –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ DevTools Console
      </h2>
      <p>–û—Ç–∫—Ä–æ–π—Ç–µ <code>https://krasnoeibeloe.ru/catalog/soki-i-nektary/?...</code> –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ Console (F12):</p>
      <div class="code-block">
const products = [];
const links = document.querySelectorAll('a[href*="/gazirovannaya-voda/"]');

links.forEach(link => {
  const href = link.href;
  if (products.some(p => p.url === href)) return;
  
  const name = link.textContent.trim();
  const parent = link.closest('[class*="item"]');
  if (!parent) return;
  
  const text = parent.textContent;
  let country = '–†–æ—Å—Å–∏—è';
  if (text.includes('–ö–æ—Ä–µ—è')) country = '–ö–æ—Ä–µ—è';
  
  const volumeMatch = text.match(/(\d+(?:\.\d+)?)\s*(–ª|–º–ª)/);
  let volume = volumeMatch ? volumeMatch[0] : '';
  
  products.push({
    name,
    country,
    volume,
    url: href,
    price: 0  // –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Ä—É—á–Ω—É—é
  });
});

console.log(`–ù–∞–π–¥–µ–Ω–æ ${products.length} —Ç–æ–≤–∞—Ä–æ–≤`);
console.table(products);
copy(JSON.stringify(products, null, 2));
console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
      </div>
    </div>

    <!-- –®–∞–≥ 3: –í—Å—Ç–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ -->
    <div class="step">
      <h2>
        <span class="step-number">3</span>
        –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      </h2>
      <p>–í—Å—Ç–∞–≤—å—Ç–µ JSON –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª:</p>
      <textarea id="jsonInput" placeholder='[
  {
    "name": "–ì–∞–∑.–≤–æ–¥–∞ –î–æ–±—Ä—ã–π –∫–æ–ª–∞ –ø—ç—Ç",
    "country": "–†–æ—Å—Å–∏—è",
    "volume": "0.3 –ª",
    "url": "https://krasnoeibeloe.ru/...",
    "price": 45
  }
]'></textarea>
      <div style="margin-top: 15px; display: flex; gap: 10px;">
        <button onclick="processData()">üîÑ –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
        <button onclick="downloadJSON()">üíæ –°–∫–∞—á–∞—Ç—å JSON</button>
        <button onclick="copyToClipboard()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
      <div id="success" class="success"></div>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats" id="stats" style="display: none;">
      <div class="stat-card">
        <div class="stat-value" id="totalCount">0</div>
        <div class="stat-label">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="avgPrice">0‚ÇΩ</div>
        <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞/–ª</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="typesCount">0</div>
        <div class="stat-label">–¢–∏–ø–æ–≤ –≥–∞–∑–∏—Ä–æ–≤–∫–∏</div>
      </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div class="step" id="resultStep" style="display: none;">
      <h2>
        <span class="step-number">‚úÖ</span>
        TypeScript –∫–æ–¥ –≥–æ—Ç–æ–≤!
      </h2>
      <textarea id="tsOutput" readonly></textarea>
      <div style="margin-top: 15px;">
        <button onclick="copyTS()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å TypeScript</button>
        <button onclick="downloadTS()">üíæ –°–∫–∞—á–∞—Ç—å .ts —Ñ–∞–π–ª</button>
      </div>
    </div>
  </div>

  <script>
    let processedData = [];

    function detectType(name) {
      const lower = name.toLowerCase();
      if (lower.includes('–∫–æ–ª–∞') || lower.includes('cola')) return '–ö–æ–ª–∞';
      if (lower.includes('–ª–∏–º–æ–Ω') && lower.includes('–ª–∞–π–º')) return '–õ–∏–º–æ–Ω-–õ–∞–π–º';
      if (lower.includes('–∞–ø–µ–ª—å—Å–∏–Ω')) return '–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤–∞—è';
      if (lower.includes('–ª–∏–º–æ–Ω–∞–¥')) return '–õ–∏–º–æ–Ω–∞–¥';
      if (lower.includes('—Ü–∏—Ç—Ä—É—Å')) return '–¶–∏—Ç—Ä—É—Å';
      return '–§—Ä—É–∫—Ç–æ–≤–∞—è';
    }

    function parseVolume(volumeText) {
      const match = volumeText.match(/(\d+(?:\.\d+)?)\s*(–ª|–º–ª)/i);
      if (!match) return 0;
      const value = parseFloat(match[1]);
      const unit = match[2].toLowerCase();
      return unit === '–ª' ? value * 1000 : value;
    }

    function getTasteProfile(type) {
      const profiles = {
        '–ö–æ–ª–∞': { sweet: 6, sour: 1, bitter: 0, alcohol: 0 },
        '–õ–∏–º–æ–Ω–∞–¥': { sweet: 5, sour: 4, bitter: 0, alcohol: 0 },
        '–ê–ø–µ–ª—å—Å–∏–Ω–æ–≤–∞—è': { sweet: 7, sour: 2, bitter: 0, alcohol: 0 },
        '–õ–∏–º–æ–Ω-–õ–∞–π–º': { sweet: 4, sour: 5, bitter: 0, alcohol: 0 },
        '–¶–∏—Ç—Ä—É—Å': { sweet: 5, sour: 5, bitter: 0, alcohol: 0 },
        '–§—Ä—É–∫—Ç–æ–≤–∞—è': { sweet: 6, sour: 3, bitter: 0, alcohol: 0 }
      };
      return profiles[type] || { sweet: 5, sour: 3, bitter: 0, alcohol: 0 };
    }

    function cleanName(name, type, volumeMl) {
      let cleaned = name
        .replace(/–ì–∞–∑\.–≤–æ–¥–∞|–ì–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫|–ù–∞–ø–∏—Ç–æ–∫|–±\/–∞|—Å—Ç|–ø—ç—Ç|–∂\/–±/gi, '')
        .trim();
      
      const brandMatch = cleaned.match(/(–î–æ–±—Ä—ã–π|–≠–∫—Å–ø–æ—Ä—Ç.*?–°—Ç–∞–∏–ª|Fresh\s*Bar|–õ—é–±–∏–º–∞—è|–ú–∏–ª–∫–∏—Å)/i);
      const brand = brandMatch ? brandMatch[1].trim() : cleaned.split(' ')[0];
      
      const volumeText = volumeMl >= 1000 ? `${volumeMl / 1000}–ª` : `${volumeMl}–º–ª`;
      return `${type} ${brand} ${volumeText}`;
    }

    function processData() {
      try {
        const input = document.getElementById('jsonInput').value;
        const rawData = JSON.parse(input);
        
        processedData = rawData.map(item => {
          const volumeMl = parseVolume(item.volume);
          const type = detectType(item.name);
          const name = cleanName(item.name, type, volumeMl);
          const pricePerLiter = volumeMl > 0 ? Math.round((item.price / volumeMl) * 1000) : 0;
          
          return {
            name,
            category: 'soda',
            color: '#00BFFF',
            abv: 0,
            pricePerLiter,
            volume: volumeMl,
            tasteProfile: getTasteProfile(type),
            unit: 'ml',
            sourceUrl: item.url,
            sourceName: '–ö—Ä–∞—Å–Ω–æ–µ&–ë–µ–ª–æ–µ',
            sourceIcon: 'https://krasnoeibeloe.ru/favicon.ico'
          };
        });

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º TypeScript
        const date = new Date().toLocaleDateString('ru-RU');
        const tsCode = `import type { Ingredient } from "@shared/schema";

/**
 * –ì–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–ø–∏—Ç–∫–∏ —Å krasnoeibeloe.ru
 * –î–∞–Ω–Ω—ã–µ —Å–æ–±—Ä–∞–Ω—ã –≤—Ä—É—á–Ω—É—é (${date})
 * –í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: ${processedData.length}
 */

export const KRASNOEIBELOE_SODAS: Partial<Ingredient>[] = [
${processedData.map(item => `  {
    name: "${item.name}",
    category: "soda",
    color: "${item.color}",
    abv: ${item.abv},
    pricePerLiter: ${item.pricePerLiter},
    volume: ${item.volume},
    tasteProfile: ${JSON.stringify(item.tasteProfile)},
    unit: "${item.unit}",
    sourceUrl: "${item.sourceUrl}",
    sourceName: "${item.sourceName}",
    sourceIcon: "${item.sourceIcon}"
  }`).join(',\n')}
];
`;

        document.getElementById('tsOutput').value = tsCode;
        document.getElementById('resultStep').style.display = 'block';

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        const avgPrice = Math.round(processedData.reduce((s, p) => s + p.pricePerLiter, 0) / processedData.length);
        const types = new Set(processedData.map(p => detectType(p.name)));
        
        document.getElementById('totalCount').textContent = processedData.length;
        document.getElementById('avgPrice').textContent = avgPrice + '‚ÇΩ';
        document.getElementById('typesCount').textContent = types.size;
        document.getElementById('stats').style.display = 'grid';

        const success = document.getElementById('success');
        success.textContent = `‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ ${processedData.length} —Ç–æ–≤–∞—Ä–æ–≤!`;
        success.style.display = 'block';
        
        setTimeout(() => {
          success.style.display = 'none';
        }, 3000);

      } catch (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
      }
    }

    function copyTS() {
      const output = document.getElementById('tsOutput');
      output.select();
      document.execCommand('copy');
      alert('TypeScript –∫–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
    }

    function downloadTS() {
      const content = document.getElementById('tsOutput').value;
      const blob = new Blob([content], { type: 'text/typescript' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'krasnoeibeloe-sodas.ts';
      a.click();
    }

    function downloadJSON() {
      const content = document.getElementById('jsonInput').value;
      const blob = new Blob([content], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'sodas-data.json';
      a.click();
    }

    function copyToClipboard() {
      const input = document.getElementById('jsonInput');
      input.select();
      document.execCommand('copy');
      alert('JSON —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
    }
  </script>
</body>
</html>
